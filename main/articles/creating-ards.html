<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating New ARDs • cards</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating New ARDs">
<link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cards</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.0.9006</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/creating-ards.html">Creating New ARDs</a></li>
    <li><a class="dropdown-item" href="../articles/structures.html">Other ARD Representations</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/cards/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Creating New ARDs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/cards/blob/main/vignettes/articles/creating-ards.Rmd" class="external-link"><code>vignettes/articles/creating-ards.Rmd</code></a></small>
      <div class="d-none name"><code>creating-ards.Rmd</code></div>
    </div>

    
    
<p>The basic functions offered by {cards} can create a wide variety of
ARDs. However, sometimes we may need to include the outputs from more
complicated statistical methods in our ARDs. In this article we’ll look
at a few different ways to implement the output from these statistical
methods.</p>
<div class="section level3">
<h3 id="cardx">{cardx}<a class="anchor" aria-label="anchor" href="#cardx"></a>
</h3>
<p>The {cardx} package is an extension of {cards}. The idea is that
{cards} provides the core functions to create ARDs, while {cardx}
contains a large number of extensions that implement various, commonly
used statistical methods. There are a large number of extensions for a
wide variety of methods, including (but not limited to):</p>
<ul>
<li>Regression models</li>
<li>ANOVA</li>
<li>Chi-squared Test</li>
<li>t-test</li>
<li>LS Mean Difference</li>
<li>Survival Estimates and Differences</li>
</ul>
<p>When looking to include the output from a statistical method your
first port of call should be to see if it has already been implemented
in {cardx}. You can find the full list of available functions <a href="https://insightsengineering.github.io/cardx/main/reference/index.html" class="external-link">here</a>.</p>
<p>Consider a simple t-test comparing the mean age (<code>AGE</code>)
across two treatments arms (<code>ARM</code>). In {cardx} we have the
function <code><a href="https://insightsengineering.github.io/cardx/main/reference/ard_stats_t_test.html" class="external-link">cardx::ard_stats_t_test()</a></code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cards</span><span class="fu">::</span><span class="va"><a href="../reference/adam.html">ADSL</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ARM</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xanomeline High Dose"</span>, <span class="st">"Xanomeline Low Dose"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">cardx</span><span class="fu">::</span><span class="fu"><a href="https://insightsengineering.github.io/cardx/main/reference/ard_stats_t_test.html" class="external-link">ard_stats_t_test</a></span><span class="op">(</span>by <span class="op">=</span> <span class="va">ARM</span>, variables <span class="op">=</span> <span class="va">AGE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">{cards} data frame: 14 x 9</span></span></span>
<span><span class="co">#&gt;    group1 variable   context   stat_name stat_label      stat</span></span>
<span><span class="co">#&gt; 1     ARM      AGE stats_t_…    estimate  Mean Dif…    -1.286</span></span>
<span><span class="co">#&gt; 2     ARM      AGE stats_t_…   estimate1  Group 1 …    74.381</span></span>
<span><span class="co">#&gt; 3     ARM      AGE stats_t_…   estimate2  Group 2 …    75.667</span></span>
<span><span class="co">#&gt; 4     ARM      AGE stats_t_…   statistic  t Statis…     -1.03</span></span>
<span><span class="co">#&gt; 5     ARM      AGE stats_t_…     p.value    p-value     0.304</span></span>
<span><span class="co">#&gt; 6     ARM      AGE stats_t_…   parameter  Degrees …   165.595</span></span>
<span><span class="co">#&gt; 7     ARM      AGE stats_t_…    conf.low  CI Lower…     -3.75</span></span>
<span><span class="co">#&gt; 8     ARM      AGE stats_t_…   conf.high  CI Upper…     1.179</span></span>
<span><span class="co">#&gt; 9     ARM      AGE stats_t_…      method     method Welch Tw…</span></span>
<span><span class="co">#&gt; 10    ARM      AGE stats_t_… alternative  alternat… two.sided</span></span>
<span><span class="co">#&gt; 11    ARM      AGE stats_t_…          mu    H0 Mean         0</span></span>
<span><span class="co">#&gt; 12    ARM      AGE stats_t_…      paired  Paired t…     FALSE</span></span>
<span><span class="co">#&gt; 13    ARM      AGE stats_t_…   var.equal  Equal Va…     FALSE</span></span>
<span><span class="co">#&gt; 14    ARM      AGE stats_t_…  conf.level  CI Confi…      0.95</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #555555;">3 more variables: fmt_fn, warning, error</span></span></span></code></pre></div>
<p>In the output, we see the outputs from the t-test; the mean
difference, confidence interval limits and p-value. It’s also useful to
see the functions inputs; for example, we can see that we did not use
equal variances as the <code>stat</code> is <code>FALSE</code> for
<code>stat_name</code> <code>var.equal</code>. This is useful for
re-use, if we need to run the test again we can use the ARD to see what
options we need to use to recreate the result.</p>
</div>
<div class="section level2">
<h2 id="create-a-new-ard_-function">Create a new <code>ard_*()</code> function<a class="anchor" aria-label="anchor" href="#create-a-new-ard_-function"></a>
</h2>
<p><em>But what do we do if the statistical method that we want to use
hasn’t been implemented already in {cardx}?</em></p>
<p>Implementing a new function to create an ARD for a statistical method
is often simple; all we need to do is write a function that outputs the
results as a named list!</p>
<p>We’ll first look at how <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom::tidy()</a></code> can make this even
easier for us, then provide an example on how to implement from
scratch.</p>
<div class="section level3">
<h3 id="using-broomtidy">Using <code>broom::tidy()</code><a class="anchor" aria-label="anchor" href="#using-broomtidy"></a>
</h3>
<p>Typically, a user will pass a function which returns a scalar value
in the <code>cards::ard_continuous(statistic)</code> argument. However,
the argument also allows for functions that return named lists, where
the names from the list will then be used as the statistic names. Since
data frames or tibbles are just named lists with a little more
formatting, we can pass a function to the <code>statistic</code>
argument which returns a single row data frame or tibble and the
behavior will be the same. Each column of the table gives the name of
the statistic via its column name, and then the corresponding value.</p>
<p>Commonly used statistical methods outputs are able to be passed
through <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom::tidy()</a></code>, which will convert the output into a
tibble. We can then pass the output of <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom::tidy()</a></code>
through to the <code>cards::ard_continuous(statistic)</code> argument of
the ARD function we wish to use, this leads to an ARD output like we see
in the above example, where we have one row per relevant input or output
from the statistical method.</p>
<p>Please note that we can only use the <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom::tidy()</a></code>
output directly, as we see in the below example, when the output is a
tibble with a single row.</p>
<p>Let’s extend our t-test example from above. This time we want to
carry out a one-sample t-test. We can just pass the code to carry out
the one-sample t-test and pass the output through
<code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom::tidy()</a></code> to the <code>statistic</code> argument like
so:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cards</span><span class="fu">::</span><span class="va"><a href="../reference/adam.html">ADSL</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ARM</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xanomeline High Dose"</span>, <span class="st">"Xanomeline Low Dose"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">cards</span><span class="fu">::</span><span class="fu"><a href="../reference/ard_continuous.html">ard_continuous</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="va">AGE</span>,</span>
<span>    statistic <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>t_test <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>context <span class="op">=</span> <span class="st">"t_test_one_sample"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">{cards} data frame: 8 x 8</span></span></span>
<span><span class="co">#&gt;   variable   context   stat_name stat_label      stat fmt_fn</span></span>
<span><span class="co">#&gt; 1      AGE t_test_o…    estimate   estimate    75.024      1</span></span>
<span><span class="co">#&gt; 2      AGE t_test_o…   statistic  statistic     120.2      1</span></span>
<span><span class="co">#&gt; 3      AGE t_test_o…     p.value    p.value         0      1</span></span>
<span><span class="co">#&gt; 4      AGE t_test_o…   parameter  parameter       167      1</span></span>
<span><span class="co">#&gt; 5      AGE t_test_o…    conf.low   conf.low    73.792      1</span></span>
<span><span class="co">#&gt; 6      AGE t_test_o…   conf.high  conf.high    76.256      1</span></span>
<span><span class="co">#&gt; 7      AGE t_test_o…      method     method One Samp…   &lt;fn&gt;</span></span>
<span><span class="co">#&gt; 8      AGE t_test_o… alternative  alternat… two.sided   &lt;fn&gt;</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #555555;">2 more variables: warning, error</span></span></span></code></pre></div>
<p>In the above chunk of code, if we focus on what we pass to the
<code>statistic</code> argument:</p>
<ul>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything()</a></code> means we want to run this test on all
columns passed to the <code>variables</code> argument.</li>
<li>
<code>t.test(x)</code> is the function which carries out the
statistical test, in this case with the default arguments.</li>
<li>We pipe the output of <code>t.test(x)</code> into
<code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom::tidy()</a></code> which converts the output of the test into a
tibble (which, remember, is just a named list!)</li>
<li>The function we’ve defined
(<code>\(x) t.test(x) |&gt; broom::tidy()</code>) itself needs to be
included in a named list, where here we’ve chosen to use the label
<code>'t_test'</code>.</li>
</ul>
<p>Over 100 different statistical methods implemented in R are able to
be ‘tidied’ using <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom::tidy()</a></code>. However, the method you
aim to use might not be, or the current <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom::tidy()</a></code>
implementation might not contain the information that you need to be in
your ARD. In that case we’ll have to format the output ourselves.</p>
</div>
<div class="section level3">
<h3 id="without-broomtidy">Without <code>broom::tidy()</code><a class="anchor" aria-label="anchor" href="#without-broomtidy"></a>
</h3>
<p>As mentioned above, we need to define a function which carries out
our required statistical method and outputs a named list of the
information we wish to include in the ARD.</p>
<p>As an example, let’s write a function which carries out a Wilcoxon
signed rank test over one variable using the function
<code>wilcox.test</code>. As an output we just want to record the method
and the p-value.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wilcox_one_var</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"method"</span>, <span class="st">"p.value"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Let’s now use this function when creating an ARD with {cards}.
Remember we just need the statistic to be a named list, so we’ll call
our function inside a named list. We also don’t need to specify any
arguments, in this case it will pick up that the one variable
<code>x</code> corresponds to the data we are testing, in this case
<code>AGE</code> for the individual treatment arms.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cards</span><span class="fu">::</span><span class="va"><a href="../reference/adam.html">ADSL</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">cards</span><span class="fu">::</span><span class="fu"><a href="../reference/ard_continuous.html">ard_continuous</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="va">AGE</span>,</span>
<span>    by <span class="op">=</span> <span class="va">ARM</span>,</span>
<span>    statistic <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wilcox <span class="op">=</span> <span class="va">wilcox_one_var</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">{cards} data frame: 6 x 10</span></span></span>
<span><span class="co">#&gt;   group1 group1_level variable stat_name stat_label      stat</span></span>
<span><span class="co">#&gt; 1    ARM      Placebo      AGE    method     method Wilcoxon…</span></span>
<span><span class="co">#&gt; 2    ARM      Placebo      AGE   p.value    p.value         0</span></span>
<span><span class="co">#&gt; 3    ARM    Xanomeli…      AGE    method     method Wilcoxon…</span></span>
<span><span class="co">#&gt; 4    ARM    Xanomeli…      AGE   p.value    p.value         0</span></span>
<span><span class="co">#&gt; 5    ARM    Xanomeli…      AGE    method     method Wilcoxon…</span></span>
<span><span class="co">#&gt; 6    ARM    Xanomeli…      AGE   p.value    p.value         0</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #555555;">4 more variables: context, fmt_fn, warning, error</span></span></span></code></pre></div>
<p>We see here that we get an output of 8 rows, 2 rows (one for the
method, and one for the p-value) for each of the 4 treatment arms.</p>
</div>
<div class="section level3">
<h3 id="complex-inputs">Complex inputs<a class="anchor" aria-label="anchor" href="#complex-inputs"></a>
</h3>
<p>The examples above are great to illustrate a simple case, but it is
perhaps a rare scenario where we are implementing a statistical method
with a single vector as its input. How would we update the code above if
we need to implement a two-sample t-test?</p>
<p>The <code><a href="../reference/ard_complex.html">cards::ard_complex()</a></code> is similar to
<code><a href="../reference/ard_continuous.html">cards::ard_continuous()</a></code>, but allows for more complex inputs
in the function passed in the <code>statistic</code> argument. In
<code><a href="../reference/ard_continuous.html">cards::ard_continuous()</a></code>, the functions passed must accept a
single vector, e.g. <code>\(x) t.test(x)</code>. But in
<code><a href="../reference/ard_complex.html">cards::ard_complex()</a></code>, in addition to the vector being
passed, the <code>data</code> subset, the <code>full_data</code>,
character <code>by</code>, and character <code>strata</code> are also
passed (see the <code><a href="../reference/ard_complex.html">cards::ard_complex()</a></code> for a full
description). Your function does not need to utilize each of these
elements, but each <em>will be passed</em> to your function. As a
result, we recommend your function accept the triple dots to handle
unused arguments.</p>
<p>An implementation of a two-sample t-test may look like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ttest_two_sample</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">x</span> <span class="op">~</span> <span class="va">data</span><span class="op">[[</span><span class="st">"ARM"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cards</span><span class="fu">::</span><span class="va"><a href="../reference/adam.html">ADSL</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ARM</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xanomeline High Dose"</span>, <span class="st">"Xanomeline Low Dose"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">cards</span><span class="fu">::</span><span class="fu"><a href="../reference/ard_complex.html">ard_complex</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="va">AGE</span>,</span>
<span>    statistic <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>t_test <span class="op">=</span> <span class="va">ttest_two_sample</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>context <span class="op">=</span> <span class="st">"t_test_two_sample"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">{cards} data frame: 10 x 8</span></span></span>
<span><span class="co">#&gt;    variable   context   stat_name stat_label      stat fmt_fn</span></span>
<span><span class="co">#&gt; 1       AGE t_test_t…    estimate   estimate    -1.286      1</span></span>
<span><span class="co">#&gt; 2       AGE t_test_t…   estimate1  estimate1    74.381      1</span></span>
<span><span class="co">#&gt; 3       AGE t_test_t…   estimate2  estimate2    75.667      1</span></span>
<span><span class="co">#&gt; 4       AGE t_test_t…   statistic  statistic     -1.03      1</span></span>
<span><span class="co">#&gt; 5       AGE t_test_t…     p.value    p.value     0.304      1</span></span>
<span><span class="co">#&gt; 6       AGE t_test_t…   parameter  parameter   165.595      1</span></span>
<span><span class="co">#&gt; 7       AGE t_test_t…    conf.low   conf.low     -3.75      1</span></span>
<span><span class="co">#&gt; 8       AGE t_test_t…   conf.high  conf.high     1.179      1</span></span>
<span><span class="co">#&gt; 9       AGE t_test_t…      method     method Welch Tw…   &lt;fn&gt;</span></span>
<span><span class="co">#&gt; 10      AGE t_test_t… alternative  alternat… two.sided   &lt;fn&gt;</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #555555;">2 more variables: warning, error</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="handling-errors">Handling errors<a class="anchor" aria-label="anchor" href="#handling-errors"></a>
</h2>
<p>Let’s consider what happens when we encounter an error in our
statistical method.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wilcox_one_var_error</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"AN ERROR!"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"method"</span>, <span class="st">"p.value"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">cards</span><span class="fu">::</span><span class="va"><a href="../reference/adam.html">ADSL</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">cards</span><span class="fu">::</span><span class="fu"><a href="../reference/ard_continuous.html">ard_continuous</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="va">AGE</span>,</span>
<span>    by <span class="op">=</span> <span class="va">ARM</span>,</span>
<span>    statistic <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wilcox <span class="op">=</span> <span class="va">wilcox_one_var_error</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">{cards} data frame: 3 x 10</span></span></span>
<span><span class="co">#&gt;   group1 group1_level variable stat_name stat_label stat     error</span></span>
<span><span class="co">#&gt; 1    ARM      Placebo      AGE    wilcox     wilcox      AN ERROR!</span></span>
<span><span class="co">#&gt; 2    ARM    Xanomeli…      AGE    wilcox     wilcox      AN ERROR!</span></span>
<span><span class="co">#&gt; 3    ARM    Xanomeli…      AGE    wilcox     wilcox      AN ERROR!</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #555555;">3 more variables: context, fmt_fn, warning</span></span></span></code></pre></div>
<p>In the output we see that we only get 4 rows of output, the error has
been stored in the <code>error</code> column but <code>stat_name</code>
and <code>stat_label</code> now just take the list name of “wilcox” that
we define in the statistic argument. This could have unintended effects
in downstream code, we may be relying on the <code>stat_name</code> and
<code>stat_label</code> having values of “method” and “p-value”, or just
that the output has 2 rows per treatment arm.</p>
<p>To handle this we can specify the expected results from our function,
so that even if we encounter an error during the code run we can be
assured that the output will be of a consistent format so as not to
impact downstream code.</p>
<p>Here’s an example of how to specify the expected output using
<code><a href="../reference/as_cards_fn.html">cards::as_cards_fn()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wilcox_one_var_error</span> <span class="op">&lt;-</span> <span class="fu">cards</span><span class="fu">::</span><span class="fu"><a href="../reference/as_cards_fn.html">as_cards_fn</a></span><span class="op">(</span></span>
<span>  <span class="va">wilcox_one_var_error</span>,</span>
<span>  stat_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"method"</span>, <span class="st">"p.value"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cards</span><span class="fu">::</span><span class="va"><a href="../reference/adam.html">ADSL</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">cards</span><span class="fu">::</span><span class="fu"><a href="../reference/ard_continuous.html">ard_continuous</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="va">AGE</span>,</span>
<span>    by <span class="op">=</span> <span class="va">ARM</span>,</span>
<span>    statistic <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wilcox <span class="op">=</span> <span class="va">wilcox_one_var_error</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">{cards} data frame: 6 x 10</span></span></span>
<span><span class="co">#&gt;   group1 group1_level variable stat_name stat_label stat     error</span></span>
<span><span class="co">#&gt; 1    ARM      Placebo      AGE    method     method      AN ERROR!</span></span>
<span><span class="co">#&gt; 2    ARM      Placebo      AGE   p.value    p.value      AN ERROR!</span></span>
<span><span class="co">#&gt; 3    ARM    Xanomeli…      AGE    method     method      AN ERROR!</span></span>
<span><span class="co">#&gt; 4    ARM    Xanomeli…      AGE   p.value    p.value      AN ERROR!</span></span>
<span><span class="co">#&gt; 5    ARM    Xanomeli…      AGE    method     method      AN ERROR!</span></span>
<span><span class="co">#&gt; 6    ARM    Xanomeli…      AGE   p.value    p.value      AN ERROR!</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #555555;">3 more variables: context, fmt_fn, warning</span></span></span></code></pre></div>
<p>Our function becomes the first argument to
<code><a href="../reference/as_cards_fn.html">cards::as_cards_fn()</a></code>, then the second argument is
<code>stat_names</code> where we specify the expected names of the
output list.</p>
<p>In the output shown here, the <code>error</code> column is still
populated with the error. However, now we have the expected 8 rows and
we can see that the <code>stat_name</code> and <code>stat_label</code>
match the values specified in the <code>stat_names</code> argument in
the <code><a href="../reference/as_cards_fn.html">as_cards_fn()</a></code>—helping us to avoid problems in code that
relies on this output.</p>
</div>
<div class="section level2">
<h2 id="formalizing-your-function">Formalizing Your Function<a class="anchor" aria-label="anchor" href="#formalizing-your-function"></a>
</h2>
<p>If you are writing function that will be used multiple times, for
example adding it to a package, you may want to include the function’s
arguments in the returned ARD. Returning the arguments improves the
traceability of the ARD, and requires combining the function’s default
arguments (the formals) and any argument passed by the user. The
<code><a href="../reference/ard_formals.html">ard_formals()</a></code> function helps combine these results.</p>
<p>In the example below, we expand out one-sample t-test example with
the argument values passed to <code>t.test(...)</code></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_ard_one_sample_t_test</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">variable</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># define function to calculate results</span></span>
<span>  <span class="va">t_test_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">t_test_fun</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">cards</span><span class="fu">::</span><span class="fu"><a href="../reference/as_cards_fn.html">as_cards_fn</a></span><span class="op">(</span></span>
<span>      <span class="va">t_test_fun</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"estimate"</span>, <span class="st">"statistic"</span>, <span class="st">"p.value"</span>, <span class="st">"parameter"</span>,</span>
<span>        <span class="st">"conf.low"</span>, <span class="st">"conf.high"</span>, <span class="st">"method"</span>, <span class="st">"alternative"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># create the ARD of results</span></span>
<span>  <span class="va">ard_results</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">cards</span><span class="fu">::</span><span class="fu"><a href="../reference/ard_continuous.html">ard_continuous</a></span><span class="op">(</span></span>
<span>      data <span class="op">=</span> <span class="va">data</span>,</span>
<span>      variables <span class="op">=</span> <span class="op">{</span><span class="op">{</span> <span class="va">variable</span> <span class="op">}</span><span class="op">}</span>,</span>
<span>      statistic <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>t_test <span class="op">=</span> <span class="va">t_test_fun</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>context <span class="op">=</span> <span class="st">"t_test_one_sample"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ard of argument values</span></span>
<span>  <span class="va">ard_arguments</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">cards</span><span class="fu">::</span><span class="fu"><a href="../reference/ard_formals.html">ard_formals</a></span><span class="op">(</span></span>
<span>      fun <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html" class="external-link">asNamespace</a></span><span class="op">(</span><span class="st">"stats"</span><span class="op">)</span><span class="op">[[</span><span class="st">"t.test.default"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      arg_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span>, <span class="st">"paired"</span>, <span class="st">"var.equal"</span>, <span class="st">"conf.level"</span><span class="op">)</span>,</span>
<span>      passed_args <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/list2.html" class="external-link">dots_list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># combine ARDs and fill arguments with missing information</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">ard_results</span>, <span class="va">ard_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">context</span><span class="op">)</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">cards</span><span class="fu">::</span><span class="va"><a href="../reference/adam.html">ADSL</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ARM</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xanomeline High Dose"</span>, <span class="st">"Xanomeline Low Dose"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">my_ard_one_sample_t_test</span><span class="op">(</span></span>
<span>    variable <span class="op">=</span> <span class="st">"AGE"</span>,</span>
<span>    var.equal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    conf.level <span class="op">=</span> <span class="fl">0.90</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">{cards} data frame: 12 x 8</span></span></span>
<span><span class="co">#&gt;    variable   context   stat_name stat_label      stat fmt_fn</span></span>
<span><span class="co">#&gt; 1       AGE t_test_o…    estimate   estimate    75.024      1</span></span>
<span><span class="co">#&gt; 2       AGE t_test_o…   statistic  statistic     120.2      1</span></span>
<span><span class="co">#&gt; 3       AGE t_test_o…     p.value    p.value         0      1</span></span>
<span><span class="co">#&gt; 4       AGE t_test_o…   parameter  parameter       167      1</span></span>
<span><span class="co">#&gt; 5       AGE t_test_o…    conf.low   conf.low    73.991      1</span></span>
<span><span class="co">#&gt; 6       AGE t_test_o…   conf.high  conf.high    76.056      1</span></span>
<span><span class="co">#&gt; 7       AGE t_test_o…      method     method One Samp…   &lt;fn&gt;</span></span>
<span><span class="co">#&gt; 8       AGE t_test_o… alternative  alternat… two.sided   &lt;fn&gt;</span></span>
<span><span class="co">#&gt; 9       AGE t_test_o…          mu         mu         0   NULL</span></span>
<span><span class="co">#&gt; 10      AGE t_test_o…      paired     paired     FALSE   NULL</span></span>
<span><span class="co">#&gt; 11      AGE t_test_o…   var.equal  var.equal      TRUE   NULL</span></span>
<span><span class="co">#&gt; 12      AGE t_test_o…  conf.level  conf.lev…       0.9   NULL</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #555555;">2 more variables: warning, error</span></span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>cards is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>





  </body>
</html>

---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# cardinal

<!-- badges: start -->
<!-- badges: end -->

The goal of cardinal is to ...

## Installation

You can install the development version of cardinal from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("insightsengineering/cardinal")
```

## Example

ARD Examples

```{r example}
library(cardinal)

ard_continuous(mtcars, by = cyl, include = c(mpg, hp)) |> 
  flatten_ard()

ard_categorical(mtcars, by = cyl, include = c(am, gear)) |> 
  flatten_ard()

ard_ttest(data = mtcars, by = "am", variable = "hp") |> 
  flatten_ard()

glm(am ~ mpg + factor(cyl), data = mtcars, family = binomial) |>
  ard_regression(add_estimate_to_reference_rows = TRUE) |> 
  flatten_ard()
```

ARD  -> Table Example

```{r}
# Construct the ARD
table_ard <-
  dplyr::bind_rows(
    ard_continuous(mtcars, by = cyl, include = mpg),
    ard_categorical(mtcars, by = cyl, include = am),
    # TODO: The ARD creation code can by simplified after the categorical
    #       ARD accepts no-by variable specifications
    mtcars |>
      dplyr::mutate(..one.. = 1L) |>
      ard_categorical(by = ..one..,  include = cyl) |>
      dplyr::select(-starts_with("strata"))
  )

# convert ARD to a cardinal table
table <-
  construct_cardinal(
    plan_table =
      dplyr::bind_rows(
        table_ard |> dplyr::filter(variable %in% "mpg") |>  plan_table_simple_continuous(),
        table_ard |> dplyr::filter(variable %in% "am") |> plan_table_simple_categorical()
      ),
    plan_header =
      table_ard |>
      dplyr::filter(variable %in% "cyl") |>
      plan_header_simple(header = "**{strata} Cylinders  \nN={n}  ({p}%)**") |>
      modifyList(val = list(label = gt::md("**Characteristic**")))
  ) |>
  convert_cardinal(engine = "gt") |> 
  gt::text_transform(
    locations = gt::cells_body(
      columns = label,
      rows = !header_row
    ),
    fn = function(x) paste0("\U00A0\U00A0\U00A0\U00A0", x)
  ) |> 
  gt::tab_style(
    style = gt::cell_text(weight = "bold"),
    locations = gt::cells_body(
      columns = label,
      rows = header_row
    )
  )
```

```{r echo=FALSE, fig.width=4}
gt::gtsave(table, filename = "man/figures/README-table_example.png")
knitr::include_graphics(path = "man/figures/README-table_example.png")
```
